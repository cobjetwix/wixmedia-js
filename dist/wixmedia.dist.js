!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.wixmedia=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){
function ImageURLTokenizer(t){this.buffer=t.toLowerCase(),this.offset=0,this.len=this.buffer.length,this.states={INITIAL:1,AFTER_KEYWORD:2,BEFORE_PARAM:3,BEFORE_VALUE:4},this.state=this.states.initial}function ImageURLParser(){this.table={},this.table.adjust=adjustMap,this.table.filter=filterMap,this.table.srz=srzMap,this.table.srb=srbMap,this.table.canvas=canvasMap,this.table.fill=fillMap,this.table.crop=cropMap,this.table.wm=wmMap}var extend=_dereq_("./utils").extend,adjustMap={br:{auto:!0,params:1},con:{auto:!0,params:1},sat:{auto:!0,params:1},hue:{auto:!0,params:1},vib:{auto:!0,params:1},auto:{standalone:!0,params:0}},filterMap={oil:{standalone:!0,params:0},neg:{standalone:!0,params:0},pix:{params:1},pixfs:{params:1},blur:{params:1},sharpen:{params:3}},a={auto:!0,params:1},us={auto:!0,params:3},whq={w:{params:1},h:{params:1},q:{params:1,auto:!0}},srzMap={a:a,us:us};extend(srzMap,whq);var srbMap={us:us};extend(srbMap,whq);var canvasMap={a:a};extend(canvasMap,srzMap);var fillMap={};extend(fillMap,srzMap);var cropMap={x:{params:1},y:{params:1}};extend(cropMap,srzMap);var wmMap={a:a,scl:{params:1},op:{params:1}};extend(wmMap,srzMap);var keywords={adjust:!0,filter:!0,crop:!0,srz:!0,srb:!0,fill:!0,canvas:!0,wm:!0},tokenTypes={UNDERSCORE:1,KEYWORD:2,VALUE:3,AUTO_VALUE:4,EOF:5,PARAM:6};ImageURLTokenizer.prototype.isLetter=function(t){return t>=65&&90>=t||t>=97&&122>=t},ImageURLTokenizer.prototype.isNumber=function(t){return 46===t||t>=48&&57>=t},ImageURLTokenizer.prototype.nextToken=function(){for(;this.offset<this.len;){var t=this.buffer.charCodeAt(this.offset),e=this.offset;if(44!==t)if(47!==t||this.state!==this.states.AFTER_KEYWORD){if(32===t)switch(this.state){case this.states.AFTER_KEYWORD:case this.states.BEFORE_PARAM:this.offset++;continue}if(this.isLetter(t)){this.offset++;do{if(t=this.buffer.charCodeAt(this.offset),!this.isLetter(t))break;this.offset++}while(this.offset<this.len);var s=this.buffer.slice(e,this.offset);if(keywords[s])return this.state=this.states.AFTER_KEYWORD,{start:e,end:this.offset,type:tokenTypes.KEYWORD,keyword:s};if((this.state===this.states.AFTER_KEYWORD||this.state===this.states.VALUE)&&"auto"===s)return{start:e,end:this.offset,type:tokenTypes.AUTO_VALUE};if(!(this.state!==this.states.AFTER_KEYWORD&&this.state!==this.states.BEFORE_PARAM||95!==t&&44!==t&&47!==t))return{start:e,end:this.offset,type:tokenTypes.PARAM,text:s};if(this.state===this.states.BEFORE_VALUE)return{start:e,end:this.offset,type:tokenTypes.VALUE,value:s}}else{if(95===t){var a={start:e,end:this.offset,type:tokenTypes.UNDERSCORE};return this.state=this.states.BEFORE_VALUE,this.offset++,a}if(this.state===this.states.BEFORE_VALUE&&(this.isNumber(t)||45===t)){this.offset++;do{if(t=this.buffer.charCodeAt(this.offset),!this.isNumber(t))break;this.offset++}while(this.offset<this.len);return{start:e,end:this.offset,type:tokenTypes.VALUE,value:this.buffer.slice(e,this.offset)}}this.state=this.states.INITIAL,this.offset++}}else this.offset++;else this.offset++,this.state=this.states.BEFORE_PARAM}return{type:tokenTypes.EOF}},ImageURLParser.prototype.parse=function(t){var e,s,a,r,i,o,n,p,f=new ImageURLTokenizer(t),h={},u=-1,l=-1,E=!0;do switch(e=f.nextToken(),e.type){case tokenTypes.EOF:E=!1;break;case tokenTypes.KEYWORD:if(-1===u&&(u=e.start),a=this.table[e.keyword],void 0===a)throw"Bad Image operation found: "+e.keyword;h[e.keyword]={},s=e.keyword;break;case tokenTypes.PARAM:if(null===a||void 0===a[e.text])throw"unknown parameter: "+e.text;if(i=a[e.text],void 0===i)throw"unknown parameter: "+e.text;if(i.standalone){h[s][e.text]=null;break}r=e.text,o=i.params,p=i.auto,n=[];break;case tokenTypes.VALUE:o--,n.push(e.value),0===o&&(h[s][r]=n.join("_")),l=e.end;break;case tokenTypes.AUTO_VALUE:if(!p)throw"auto not allowed for parameter: "+r;h[s][r]=e.value,l=e.end}while(E);var d=t.substring(0,u-1).split("/"),m=d.pop(),R=d.join("/");return{imageId:m,imageName:t.substring(l+1),endpoint:R,api:h}};var parser=new ImageURLParser;module.exports.parse=function(t){return parser.parse(t)};
},{"./utils":2}],2:[function(_dereq_,module,exports){
module.exports.extend=function(r,e){for(var n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);return r};
},{}],3:[function(_dereq_,module,exports){
function sharpenParams(t,i,n){return void 0!==i||void 0!==n||void 0!==t&&t!==DEFAULT_AUTO?{r:t,a:i,t:n}:{auto:!0}}function outputSharpening(t){return void 0!==t?t.auto===!0?DEFAULT_AUTO:t.r+"_"+t.a+"_"+t.t:""}function outputParams(t,i){var n="";for(var o in t)t.hasOwnProperty(o)&&(n.length>0&&(n+=","),n+=null!==t[o]?o+"_"+t[o]:o);return i+"/"+n}function ArtisticAPI(t,i,n,o,e){if(this.endpoint=t,this.imageId=i,this.imageName=n,this.opName=o,this.options={},void 0!==e)for(var r in e)e.hasOwnProperty(r)&&(this.options[r]=e[r])}function AdjustAPI(t,i,n,o){ArtisticAPI.call(this,t,i,n,"adjust",o)}function FilterAPI(t,i,n,o){ArtisticAPI.call(this,t,i,n,"filter",o)}function OperationMixin(t,i,n,o,e,r,p){this.endpoint=t,this.imageId=i,this.imageName=n,this.opName=o,this.operations={};var s=this;if(this.adj=new AdjustAPI(null,null,null,p),this.adj.toUrl=function(){return s.toUrl()},this.adj[o]=function(){return s},this.adj.filter=function(){return s.filter()},this.fil=new FilterAPI(null,null,null,r),this.fil[o]=function(){return s},this.fil.adjust=function(){return s.adjust()},this.fil.toUrl=function(){return s.toUrl()},void 0!==e)for(var a in e)e.hasOwnProperty(a)&&(this.operations[a]=e[a])}function WidthHeightQualityMixin(){}function UnsharpMaskMixin(){}function AlignmentMixin(){}function OpSrz(t,i,n,o,e,r){OperationMixin.call(this,t,i,n,"srz",o,e,r),WidthHeightQualityMixin.call(this),UnsharpMaskMixin.call(this)}function OpSrb(t,i,n,o,e){OperationMixin.call(this,t,i,n,"srb",o,e)}function OpCanvas(t,i,n,o,e){OperationMixin.call(this,t,i,n,"canvas",o,e),this.anchor=this.alignment}function OpFill(t,i,n,o,e){OperationMixin.call(this,t,i,n,"fill",o,e)}function OpCrop(t,i,n,o,e){OperationMixin.call(this,t,i,n,"crop",o,e)}function OpWm(t,i,n,o,e){OperationMixin.call(this,t,i,n,"wm",o,e)}function handleUrl(t){var i=parser.parse(t),n=null,o=null,e=null,r={},p={};return i.api.hasOwnProperty("filter")?(o=new FilterAPI(i.endpoint,i.imageId,i.imageName,i.api.filter),p=i.api.filter):i.api.hasOwnProperty("adjust")&&(e=new AdjustAPI(i.endpoint,i.imageId,i.imageName,i.api.adjust),r=i.api.adjust),i.api.hasOwnProperty("srz")?n=new OpSrz(i.endpoint,i.imageId,i.imageName,i.api.srz,p,r):i.api.hasOwnProperty("srb")?n=new OpSrb(i.endpoint,i.imageId,i.imageName,i.api.srb,p,r):i.api.hasOwnProperty("canvas")?n=new OpCanvas(i.endpoint,i.imageId,i.imageName,i.api.canvas,p,r):i.api.hasOwnProperty("fill")?n=new OpFill(i.endpoint,i.imageId,i.imageName,i.api.fill,p,r):i.api.hasOwnProperty("wm")?n=new OpWm(i.endpoint,i.imageId,i.imageName,i.api.wm,p,r):i.api.hasOwnProperty("crop")&&(n=new OpCrop(i.endpoint,i.imageId,i.imageName,i.api.crop,p,r)),null===n?null!==o?o:e:n}var extend=_dereq_("./utils").extend,parser=_dereq_("./parser"),DEFAULT_QUALITY=75,DEFAULT_USM_RADIUS=.5,DEFAULT_USM_THRESHOLD=0,DEFAULT_USM_AMOUNT=.2,DEFAULT_AUTO="auto",alignments={CENTER:"c",CENTER_TOP:"t",TOP_LEFT:"tl",TOP_RIGHT:"tr",CENTER_BOTTOM:"b",BOTTOM_LEFT:"bl",BOTTOM_RIGHT:"br",CENTER_LEFT:"l",CENTER_RIGHT:"r",AUTO:DEFAULT_AUTO},SRZ_ALIGNMENTS={FACE_RECOGNITION:"f"};extend(SRZ_ALIGNMENTS,alignments);var CANVAS_ANCHORS={ALL_FACES:"fs"};extend(CANVAS_ANCHORS,alignments),ArtisticAPI.prototype.toUrl=function(){return this.endpoint+"/"+this.imageId+"/"+this.chainedUrl()+"/"+this.imageName},ArtisticAPI.prototype.chainedUrl=function(){return outputParams(this.options,this.opName)},ArtisticAPI.prototype.hasOptions=function(){for(var t in this.options)if(this.options.hasOwnProperty(t))return!0;return!1},extend(AdjustAPI.prototype,ArtisticAPI.prototype),AdjustAPI.prototype.brightness=function(t){return this.options.br=t||DEFAULT_AUTO,this},AdjustAPI.prototype.br=AdjustAPI.prototype.brightness,AdjustAPI.prototype.contrast=function(t){return this.options.con=t||DEFAULT_AUTO,this},AdjustAPI.prototype.con=AdjustAPI.prototype.contrast,AdjustAPI.prototype.saturation=function(t){return this.options.sat=t||DEFAULT_AUTO,this},AdjustAPI.prototype.sat=AdjustAPI.prototype.saturation,AdjustAPI.prototype.hue=function(t){return this.options.hue=t||DEFAULT_AUTO,this},AdjustAPI.prototype.vibrance=function(t){return this.options.vib=t||DEFAULT_AUTO,this},AdjustAPI.prototype.vib=AdjustAPI.prototype.vibrance,AdjustAPI.prototype.auto=function(t){return void 0!==t&&t===!1?(delete this.options.auto,this):(this.options.auto=null,this)},AdjustAPI.prototype.chainedUrl=function(){return this.options.auto?this.opName+"/"+DEFAULT_AUTO:ArtisticAPI.prototype.chainedUrl.call(this)},extend(FilterAPI.prototype,ArtisticAPI.prototype),FilterAPI.prototype.oil=function(t){return void 0!==t&&t===!1?delete this.options.oil:this.options.oil=null,this},FilterAPI.prototype.negative=function(t){return void 0!==t&&t===!1?delete this.options.neg:this.options.neg=null,this},FilterAPI.prototype.neg=FilterAPI.prototype.negative,FilterAPI.prototype.pixelate=function(t){return this.options.pix=t,this},FilterAPI.prototype.pix=FilterAPI.prototype.pixelate,FilterAPI.prototype.pixelateFaces=function(t){return this.options.pixfs=t,this},FilterAPI.prototype.pixfs=FilterAPI.prototype.pixelateFaces,FilterAPI.prototype.blur=function(t){return this.options.blur=t,this},FilterAPI.prototype.sharpen=function(t,i,n){return this.options.sharpen=outputSharpening(sharpenParams(t,i,n)),this},OperationMixin.prototype={toUrl:function(){var t=this.endpoint+"/"+this.imageId+"/"+outputParams(this.operations,this.opName);return this.adj.hasOptions()&&(t+="/"+this.adj.chainedUrl()),this.fil.hasOptions()&&(t+="/"+this.fil.chainedUrl()),t+"/"+this.imageName},filter:function(){return this.fil},adjust:function(){return this.adj}},WidthHeightQualityMixin.prototype={width:function(t){return this.operations.w=t,this},height:function(t){return this.operations.h=t,this},size:function(t,i,n){return this.width(t),this.height(i),void 0!==n&&this.quality(n),this},quality:function(t){return this.operations.q=t,this}},WidthHeightQualityMixin.prototype.w=WidthHeightQualityMixin.prototype.width,WidthHeightQualityMixin.prototype.h=WidthHeightQualityMixin.prototype.height,WidthHeightQualityMixin.prototype.q=WidthHeightQualityMixin.prototype.quality,UnsharpMaskMixin.prototype.unsharpMask=function(t,i,n){return this.operations.us=outputSharpening(sharpenParams(t,i,n)),this},UnsharpMaskMixin.prototype.us=UnsharpMaskMixin.prototype.unsharpMask,AlignmentMixin.prototype={alignment:function(t){return this.operations.a=t,this}},AlignmentMixin.prototype.a=AlignmentMixin.prototype.alignment,extend(OpSrz.prototype,OperationMixin.prototype),extend(OpSrz.prototype,WidthHeightQualityMixin.prototype),extend(OpSrz.prototype,AlignmentMixin.prototype),extend(OpSrz.prototype,UnsharpMaskMixin.prototype),extend(OpSrb.prototype,OperationMixin.prototype),extend(OpSrb.prototype,WidthHeightQualityMixin.prototype),extend(OpSrb.prototype,UnsharpMaskMixin.prototype),extend(OpCanvas.prototype,OperationMixin.prototype),extend(OpCanvas.prototype,WidthHeightQualityMixin.prototype),extend(OpCanvas.prototype,AlignmentMixin.prototype),extend(OpFill.prototype,OperationMixin.prototype),extend(OpFill.prototype,WidthHeightQualityMixin.prototype),extend(OpCrop.prototype,OperationMixin.prototype),extend(OpCrop.prototype,WidthHeightQualityMixin.prototype),OpCrop.prototype.x=function(t){return this.operations.x=t,this},OpCrop.prototype.y=function(t){return this.operations.y=t,this},OpCrop.prototype.coords=function(t,i){return this.x(t),this.y(i),this},extend(OpWm.prototype,OperationMixin.prototype),extend(OpWm.prototype,AlignmentMixin.prototype),OpWm.prototype.opacity=function(t){return this.operations.op=t,this},OpWm.prototype.op=OpWm.prototype.opacity,OpWm.prototype.scale=function(t){return this.operations.scl=t,this},OpWm.prototype.scl=OpWm.prototype.scale,module.exports={endpoint:function(t){this._endpoint=t},fromUrl:function(t){return handleUrl(t)},srz:function(t,i,n,o,e){return new OpSrz(this._endpoint,t,i,n,o,e)},srb:function(t,i,n,o,e){return new OpSrb(this._endpoint,t,i,n,o,e)},canvas:function(t,i,n,o,e){return new OpCanvas(this._endpoint,t,i,n,o,e)},fill:function(t,i,n,o,e){return new OpFill(this._endpoint,t,i,n,o,e)},crop:function(t,i,n,o,e){return new OpCrop(this._endpoint,t,i,n,o,e)},wm:function(t,i,n,o,e){return new OpWm(this._endpoint,t,i,n,o,e)},adjust:function(t,i,n,o,e){return new AdjustAPI(this._endpoint,t,i,n,o,e)},filter:function(t,i,n,o,e){return new FilterAPI(this._endpoint,t,i,n,o,e)},SRZ:{Alignment:SRZ_ALIGNMENTS},WM:{Alignment:alignments},CANVAS:{ANCHORS:CANVAS_ANCHORS},Defaults:{QUALITY:DEFAULT_QUALITY,USM_RADIUS:DEFAULT_USM_RADIUS,USM_AMOUNT:DEFAULT_USM_AMOUNT,USM_THRESHOLD:DEFAULT_USM_THRESHOLD,AUTO:DEFAULT_AUTO}};
},{"./parser":1,"./utils":2}]},{},[3])
(3)
});